<!-- src/app/features/products/product-detail/product-detail.component.html -->
<div class="product-detail-container">
  <div *ngIf="isLoading()" class="loading-indicator">Loading product details...</div>
  <div *ngIf="errorMessage()" class="error-message">{{ errorMessage() }}</div>

  <div *ngIf="!isLoading() && product() as currentProduct; else notFound">
    <div class="breadcrumb">
      <a routerLink="/products">Products</a> >
      <span *ngIf="currentProduct.categoryName">
        <a [routerLink]="['/products']" [queryParams]="{ categoryId: currentProduct.categoryId }">{{ currentProduct.categoryName }}</a> >
      </span>
      <span>{{ currentProduct.name }}</span>
    </div>

    <div class="detail-grid">
      <div class="product-gallery">
        <img
          *ngIf="currentProduct.mainImageUrl"
          [ngSrc]="currentProduct.mainImageUrl"
          [alt]="currentProduct.name"
          width="400"
          height="400"
          priority />
        <img
          *ngIf="!currentProduct.mainImageUrl && currentProduct.productImages && currentProduct.productImages.length > 0"
          [ngSrc]="currentProduct.productImages[0].imageUrl"
          [alt]="currentProduct.name"
          width="400"
          height="400"
          priority />
        <ng-template #placeholder>
          <div *ngIf="!currentProduct.mainImageUrl && (!currentProduct.productImages || currentProduct.productImages.length === 0)" class="image-placeholder-large">No Image Available</div>
        </ng-template>
      </div>

      <div class="product-info">
        <h1>{{ currentProduct.name }}</h1>
        <div class="product-meta">
          <span class="category" *ngIf="currentProduct.categoryName">
            Category: <a [routerLink]="['/products']" [queryParams]="{ categoryId: currentProduct.categoryId }">{{ currentProduct.categoryName }}</a>
          </span>
          <span class="sku" *ngIf="currentProduct.sku">SKU: {{ currentProduct.sku }}</span>
        </div>

        <div class="price-section">
          <span class="current-price">{{ currentProduct.price | currency:'TRY':'symbol':'1.2-2' }}</span>
        </div>

        <div class="stock-status" [class.in-stock]="currentProduct.stock && currentProduct.stock > 0" [class.out-of-stock]="!currentProduct.stock || currentProduct.stock === 0">
          {{ (currentProduct.stock && currentProduct.stock > 0) ? 'In Stock (' + currentProduct.stock + ' available)' : 'Out of Stock' }}
        </div>

        <div class="actions">
          <!-- Miktar seçici eklenebilir -->
          <button (click)="addToCartHandler()" class="btn-add-to-cart"
                  [disabled]="!currentProduct.stock || currentProduct.stock === 0 || !isProductActive(currentProduct) || !isProductApproved(currentProduct)">
            <span class="material-icons">shopping_cart</span>
            {{ (!currentProduct.stock || currentProduct.stock === 0) ? 'Out of Stock' :
               (!isProductActive(currentProduct) || !isProductApproved(currentProduct)) ? 'Unavailable' :
               'Add to Cart' }}
          </button>
          <button
            class="btn-wishlist"
            [class.wishlisted]="isWishlisted()"
            (click)="toggleWishlist()"
            [disabled]="isTogglingWishlist()">
            <span class="material-icons">{{ isWishlisted() ? 'favorite' : 'favorite_border' }}</span>
            <!-- FAVORITE yazısı kaldırıldı -->
          </button>
        </div>

        <div class="description" *ngIf="currentProduct.description">
          <h3>Product Description</h3>
          <p [innerHTML]="currentProduct.description | nl2br"></p>
        </div>
      </div>
    </div>

    <!-- Product Reviews Section -->
    <div class="product-reviews-section">
      <app-product-reviews [productId]="currentProduct.id"></app-product-reviews>
    </div>

  </div>
  <ng-template #notFound>
    <p *ngIf="!isLoading() && !errorMessage()">Product not found.</p>
  </ng-template>
</div>
